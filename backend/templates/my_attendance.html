<!DOCTYPE html>
<html>
<head>
    <title>My Attendance</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<!-- ðŸŒ™ Dark Mode Toggle (Top-Left) -->
<button
    onclick="toggleTheme()"
    style="
        position: fixed;
        top: 15px;
        left: 15px;
        z-index: 9999;
    "
    class="btn btn-sm btn-outline-secondary shadow"
>
    ðŸŒ™
</button>



<div class="container mt-4">
    <h2>My Attendance</h2>

    <div class="row mb-3">
        <div class="col-md-4">
    <label>User ID</label>
    <input type="number" id="userId" class="form-control" placeholder="Enter User ID">
</div>


        <div class="col-md-4">
            <label>Month</label>
            <input type="month" id="month" class="form-control">
        </div>

        <div class="col-md-4 d-flex align-items-end">
            <button class="btn btn-primary w-100" onclick="loadAttendance()">View</button>
        </div>
    </div>

    <div class="alert alert-success">
        <strong id="workingDays">Total Working Days: 0</strong><br>
        <strong id="presentDays">Total Present Days: 0</strong><br>
        <strong id="percentage">Attendance Percentage: 0%</strong>
    </div>

    <table class="table table-bordered table-striped">
        <thead class="table-dark">
            <tr>
                <th>Date</th>
                <th>Check In</th>
                <th>Check Out</th>
            </tr>
        </thead>
        <tbody id="attendanceTable"></tbody>
    </table>
</div>

<script>
async function loadAttendance() {
    const userId = document.getElementById("userId").value;
    const month = document.getElementById("month").value;

    if (!userId || !month) {
        alert("Please enter User ID and select Month");
        return;
    }

    const res = await fetch(
        `/api/attendance/my-attendance?user_id=${userId}&month=${month}`
    );

    const data = await res.json();

    const table = document.getElementById("attendanceTable");
    table.innerHTML = "";

    data.forEach(r => {
        table.innerHTML += `
            <tr>
                <td>${r.date}</td>
                <td>${r.check_in}</td>
                <td>${r.check_out}</td>
            </tr>
        `;
    });

    const summaryRes = await fetch(
        `/api/attendance/my-summary?user_id=${userId}&month=${month}`
    );
    const summary = await summaryRes.json();

    document.getElementById("workingDays").innerText =
        "Total Working Days: " + summary.working_days;
    document.getElementById("presentDays").innerText =
        "Total Present Days: " + summary.present_days;
    document.getElementById("percentage").innerText =
        "Attendance Percentage: " + summary.percentage + "%";
}

document.getElementById("month").value =
    new Date().toISOString().slice(0,7);


function applyTheme() {
    const mode = localStorage.getItem("theme");
    if (mode === "dark") {
        document.body.classList.add("dark-mode");
    } else {
        document.body.classList.remove("dark-mode");
    }
}

function toggleTheme() {
    const isDark = document.body.classList.toggle("dark-mode");
    localStorage.setItem("theme", isDark ? "dark" : "light");
}

// Apply theme on load
applyTheme();
</script>


</body>
</html>
