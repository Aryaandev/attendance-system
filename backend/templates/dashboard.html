<!DOCTYPE html>
<html>
<head>
    <title>Employee Dashboard</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="/static/style.css" rel="stylesheet">
</head>

<body class="d-flex justify-content-center align-items-center">

<!-- üåô Dark Mode Toggle -->
<button onclick="toggleTheme()"
    style="position:fixed;top:15px;left:15px;z-index:9999"
    class="btn btn-sm btn-outline-secondary shadow">üåô</button>

<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-5">

            <div class="card p-4 text-center">

                <h3 class="mb-1">üë®‚Äçüíº Employee Dashboard</h3>
                <p class="text-muted mb-3">Attendance Management</p>

                <!-- USER INFO -->
                <div class="alert alert-info">
                    Logged in as <b>User ID:</b>
                    <span id="userIdDisplay"></span>
                </div>

                <!-- STATUS -->
                <div id="status" class="alert alert-secondary">
                    Waiting for action
                </div>

                <!-- CLOCK -->
                <p class="text-muted mb-4">
                    üïí <span id="currentTime"></span>
                </p>

                <!-- ACTION BUTTONS -->
                <div class="d-grid gap-3">
                    <button id="checkInBtn" class="btn btn-success btn-lg" onclick="checkIn()">
                        ‚úÖ Check In
                    </button>

                    <button id="checkOutBtn" class="btn btn-danger btn-lg" onclick="checkOut()">
                        ‚èπ Check Out
                    </button>
                </div>

                <hr class="my-4">

                <a href="/my-attendance" class="btn btn-outline-primary w-100">
                    üìä View My Attendance
                </a>

                <button onclick="logout()" class="btn btn-outline-dark w-100 mt-3">
                    üö™ Logout
                </button>

            </div>

        </div>
    </div>
</div>

<script>
/* ================= AUTH CHECK ================= */
const role = localStorage.getItem("role");
const token = localStorage.getItem("token");
const userId = localStorage.getItem("user_id");

if (!token || role !== "employee") {
    alert("Unauthorized access");
    window.location.href = "/employee-login";
}

document.getElementById("userIdDisplay").innerText = userId;

/* ================= CLOCK ================= */
function updateTime() {
    document.getElementById("currentTime").innerText =
        new Date().toLocaleString();
}
setInterval(updateTime, 1000);
updateTime();

/* ================= CHECK IN ================= */
async function checkIn() {
    setLoading(true);

    const res = await fetch("/api/attendance/checkin", {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
            "Authorization": "Bearer " + token
        },
        body: JSON.stringify({ user_id: userId })
    });

    const data = await res.json();

    setLoading(false);
    showStatus(res.ok ? "success" : "danger", data.message || data.error);
}

/* ================= CHECK OUT ================= */
async function checkOut() {
    setLoading(true);

    const res = await fetch("/api/attendance/checkout", {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
            "Authorization": "Bearer " + token
        },
        body: JSON.stringify({ user_id: userId })
    });

    const data = await res.json();

    setLoading(false);
    showStatus(res.ok ? "danger" : "warning", data.message || data.error);
}

/* ================= HELPERS ================= */
function showStatus(type, message) {
    const el = document.getElementById("status");
    el.className = "alert alert-" + type;
    el.innerText = message;
}

function setLoading(loading) {
    document.getElementById("checkInBtn").disabled = loading;
    document.getElementById("checkOutBtn").disabled = loading;
}

/* ================= LOGOUT ================= */
function logout() {
    localStorage.clear();
    window.location.href = "/employee-login";
}

/* ================= DARK MODE ================= */
function applyTheme() {
    if (localStorage.getItem("theme") === "dark") {
        document.body.classList.add("dark-mode");
    }
}
applyTheme();

function toggleTheme() {
    document.body.classList.toggle("dark-mode");
    localStorage.setItem(
        "theme",
        document.body.classList.contains("dark-mode") ? "dark" : "light"
    );
}
</script>

</body>
</html>
