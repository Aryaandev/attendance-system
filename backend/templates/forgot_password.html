<!DOCTYPE html>
<html>
<head>
    <title>Forgot Password</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="/static/style.css" rel="stylesheet">
</head>

<body class="d-flex justify-content-center align-items-center">

<button onclick="toggleTheme()"
    style="position:fixed;top:15px;left:15px;z-index:9999"
    class="btn btn-sm btn-outline-secondary">üåô</button>

<div class="card p-4 shadow" style="width:380px">
    <h4 class="text-center mb-3">üîê Reset Password</h4>

    <form onsubmit="resetPassword(event)">
        <div class="mb-3">
            <label>User ID (Employee)</label>
            <input id="user_id" type="number" class="form-control">
        </div>

        <div class="mb-3 text-center fw-bold">OR</div>

        <div class="mb-3">
            <label>Email (Admin)</label>
            <input id="email" type="email" class="form-control">
        </div>

        <div class="mb-3">
            <label>New Password</label>
            <input id="new_password" type="password" class="form-control" required>
        </div>

        <button class="btn btn-primary w-100">Update Password</button>
    </form>

    <div class="text-center mt-3">
        <a href="/login">Back to Login</a>
    </div>
</div>

<script>
function applyTheme() {
    if (localStorage.getItem("theme") === "dark") {
        document.body.classList.add("dark-mode");
    }
}
applyTheme();

function toggleTheme() {
    document.body.classList.toggle("dark-mode");
    localStorage.setItem(
        "theme",
        document.body.classList.contains("dark-mode") ? "dark" : "light"
    );
}

async function resetPassword(e) {
    e.preventDefault();

    const payload = {
        new_password: new_password.value
    };

    if (user_id.value) payload.user_id = user_id.value;
    if (email.value) payload.email = email.value;

    const res = await fetch("/api/auth/reset-password", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
    });

    const data = await res.json();

    if (res.ok) {
        alert("Password updated. Please login again.");
        window.location.href = "/login";
    } else {
        alert(data.error);
    }
}
</script>

</body>
</html>
