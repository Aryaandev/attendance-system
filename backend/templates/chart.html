<!DOCTYPE html>
<html>
<head>
    <title>Attendance Analytics</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-light">


<div class="container mt-4">
    <h2>Attendance Analytics</h2>

    <button class="btn btn-secondary mb-3" onclick="goBack()">â¬… Back to Admin</button>

    <div class="row mb-3">
        <div class="col-md-4">
            <label>User ID</label>
            <input type="number" id="userId" class="form-control">
        </div>

        <div class="col-md-4">
            <label>Month</label>
            <input type="month" id="month" class="form-control">
        </div>

        <div class="col-md-4 d-flex align-items-end">
            <button class="btn btn-primary w-100" onclick="loadChart()">Load Chart</button>
        </div>
    </div>

    <div class="alert alert-info">
        <strong id="workingDays">Total Working Days: 0</strong><br>
        <strong id="totalDays">Total Present Days: 0</strong><br>
        <strong id="attendancePercent">Attendance Percentage: 0%</strong>
    </div>

    <canvas id="attendanceChart"></canvas>
</div>

<script>
let chart = null;

function goBack() {
    window.location.href = "/admin";
}

async function loadChart() {
    const month = document.getElementById("month").value;
    const userId = document.getElementById("userId").value;

    let url = `/api/admin/monthly-stats?month=${month}`;
    if (userId) url += `&user_id=${userId}`;

    const res = await fetch(url);
    const data = await res.json();

    document.getElementById("workingDays").innerText =
        "Total Working Days: " + data.total_working;
    document.getElementById("totalDays").innerText =
        "Total Present Days: " + data.total_present;
    document.getElementById("attendancePercent").innerText =
        "Attendance Percentage: " + data.percentage + "%";

    const ctx = document.getElementById("attendanceChart");

    if (chart) chart.destroy();

    chart = new Chart(ctx, {
        type: "bar",
        data: {
            labels: data.labels,
            datasets: [{
                label: "Attendance",
                data: data.counts,
                backgroundColor: "#0d6efd"
            }]
        }
    });
}

document.getElementById("month").value =
    new Date().toISOString().slice(0,7);

function applyTheme() {
    const mode = localStorage.getItem("theme");
    if (mode === "dark") {
        document.body.classList.add("dark-mode");
    } else {
        document.body.classList.remove("dark-mode");
    }
}

function toggleTheme() {
    const isDark = document.body.classList.toggle("dark-mode");
    localStorage.setItem("theme", isDark ? "dark" : "light");
}

// Apply theme on load
applyTheme();
</script>

</body>
</html>
